<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AI Studio 20-in-1 â€” ÙˆØ¨â€ŒØ§Ù¾ Ù¾ÛŒØ´Ø±ÙØªÙ‡</title>
  <meta name="description" content="ÛŒÚ© ÙˆØ¨â€ŒØ§Ù¾ ØªÚ© ÙØ§ÛŒÙ„ Ø¨Ø§ 20 Ø§Ø¨Ø²Ø§Ø± Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ: Ø®Ù„Ø§ØµÙ‡â€ŒØ³Ø§Ø²ÛŒØŒ Ø¨Ø§Ø²Ù†ÙˆÛŒØ³ÛŒØŒ ØªÙˆÙ„ÛŒØ¯ Ù¾Ø±Ø§Ù…Ù¾ØªØŒ ØªØ­Ù„ÛŒÙ„ Ø§Ø­Ø³Ø§Ø³Ø§ØªØŒ Ú©Ù„Ù…Ø§Øª Ú©Ù„ÛŒØ¯ÛŒ Ùˆ Ø¨ÛŒØ´ØªØ±." />
  <style>
    :root{
      --bg: #0b0f16;
      --panel: #121826;
      --panel-2: #0f1420;
      --txt: #e7edf7;
      --sub: #b4c0d3;
      --primary: #6ea8ff;
      --accent: #9d7dff;
      --muted: #2a3346;
      --border: #1c2434;
      --ok: #20c997;
      --warn: #f59f00;
      --err: #ff6b6b;
      --shadow: 0 10px 30px rgba(0,0,0,0.35), inset 0 1px 0 rgba(255,255,255,0.02);
      --radius: 14px;
    }
    *{box-sizing:border-box}
    body{
      margin:0; background: radial-gradient(1200px 700px at 80% -10%, rgba(157,125,255,.15), transparent 60%),
                          radial-gradient(900px 600px at 10% -30%, rgba(110,168,255,.12), transparent 65%),
                          var(--bg);
      color:var(--txt); font: 15px/1.6 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Naskh Arabic", "Vazirmatn", Tahoma, Arial;
    }
    header{
      display:flex; align-items:center; justify-content:space-between;
      padding:18px clamp(16px, 4vw, 28px); position:sticky; top:0; z-index:10;
      background: linear-gradient(180deg, rgba(11,15,22,.9), rgba(11,15,22,.6));
      backdrop-filter: blur(10px); border-bottom:1px solid var(--border);
    }
    .brand{display:flex; gap:12px; align-items:center;}
    .logo{
      width:40px; height:40px; border-radius:12px;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      display:grid; place-items:center; box-shadow: var(--shadow); color:white; font-weight:800;
    }
    .brand h1{margin:0; font-size:18px}
    .brand p{margin:0; color:var(--sub); font-size:12px}
    .row{display:grid; grid-template-columns: 300px 1fr; gap:18px; padding:18px clamp(16px, 4vw, 28px)}
    @media (max-width: 980px){ .row{grid-template-columns:1fr} }
    .panel{
      background: linear-gradient(180deg, rgba(18,24,38,.95), rgba(15,20,32,.95));
      border:1px solid var(--border); border-radius: var(--radius); box-shadow: var(--shadow);
    }
    .side{padding:16px}
    .search{position:relative}
    .search input{
      width:100%; background: var(--panel-2); border:1px solid var(--border);
      color:var(--txt); padding:12px 14px; border-radius:10px; outline:none;
    }
    .tasks{margin-top:12px; display:flex; flex-direction:column; gap:8px; max-height: calc(100vh - 210px); overflow:auto; padding-right:2px}
    .task{
      display:flex; align-items:center; gap:10px; padding:10px; border-radius:10px;
      background: transparent; border:1px solid transparent; cursor:pointer;
    }
    .task:hover{background:rgba(255,255,255,.03); border-color:var(--border)}
    .task.active{background:linear-gradient(180deg, rgba(110,168,255,.08), rgba(157,125,255,.08)); border-color:transparent}
    .task .ico{width:32px; height:32px; display:grid; place-items:center; background:var(--panel-2); border-radius:8px; border:1px solid var(--border)}
    .task .name{font-weight:600}
    .task .desc{font-size:12px; color:var(--sub)}
    .settings{margin-top:16px; padding:12px; background:var(--panel-2); border:1px solid var(--border); border-radius:10px}
    .settings h3{margin:0 0 8px 0; font-size:13px; color:var(--sub)}
    .settings label{display:block; font-size:12px; color:var(--sub); margin-top:8px}
    .settings input, .settings select{
      width:100%; background:#0b1220; border:1px solid var(--border); color:var(--txt);
      padding:8px 10px; border-radius:8px; outline:none; font-size:13px;
    }

    .main{display:grid; gap:14px; align-content:start; padding:16px}
    .hero{
      padding:14px; border:1px dashed var(--muted); border-radius:12px; background: rgba(255,255,255,.02)
    }
    .hero strong{color:var(--primary)}
    .grid{display:grid; grid-template-columns:1fr 1fr; gap:14px}
    @media (max-width: 980px){ .grid{grid-template-columns:1fr} }
    .card{padding:14px; border:1px solid var(--border); border-radius:12px; background: var(--panel)}
    .card h3{margin:0 0 10px 0; font-size:14px; color:var(--sub)}
    textarea, input[type="text"], input[type="number"], select{
      width:100%; resize:vertical; min-height:120px; background: var(--panel-2); color:var(--txt);
      border:1px solid var(--border); border-radius:10px; padding:10px; outline:none;
    }
    textarea.small{min-height:80px}
    .inline{display:flex; gap:10px; align-items:center; flex-wrap:wrap}
    .inline > *{flex:1}
    .btn{
      background: linear-gradient(135deg, var(--primary), var(--accent)); color:white; border:none;
      padding:12px 16px; border-radius:10px; cursor:pointer; font-weight:700; box-shadow: var(--shadow)
    }
    .btn.secondary{background:transparent; border:1px solid var(--border); color:var(--txt); box-shadow:none}
    .btn.ghost{background:transparent; color:var(--sub); border:none}
    .toolbar{display:flex; gap:10px; align-items:center; justify-content:flex-end}
    .output{
      white-space:pre-wrap; word-break:break-word; background: #0c111a; border:1px solid var(--border);
      border-radius:12px; padding:14px; min-height:180px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Courier New", monospace;
    }
    .footer{padding:10px; color:var(--sub); font-size:12px; text-align:center}
    .chip{display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; border:1px solid var(--border); background:rgba(255,255,255,.03); font-size:12px}
    .status{font-size:12px; color:var(--sub)}
    .kpi{display:flex; gap:8px; flex-wrap:wrap}
    .kpi .item{background:rgba(255,255,255,.03); border:1px solid var(--border); padding:8px 10px; border-radius:8px; font-size:12px}
    .sep{height:1px; background:var(--border); margin:10px 0}
    .notice{font-size:12px; color:var(--sub)}
  </style>
</head>
<body>
<header>
  <div class="brand">
    <div class="logo">AI</div>
    <div>
      <h1>AI Studio â€” 20 Ø§Ø¨Ø²Ø§Ø± Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø¯Ø± ÛŒÚ© ØµÙØ­Ù‡</h1>
      <p>Ù†Ø³Ø®Ù‡ Ø³Ø¨Ú©ØŒ Ù…Ø¯Ø±Ù†ØŒ Ù‚Ø§Ø¨Ù„ Ø§Ù†ØªØ´Ø§Ø± Ø±ÙˆÛŒ GitHub Pages (Ø¨Ø¯ÙˆÙ† Ø¨Ú©â€ŒØ§Ù†Ø¯)</p>
    </div>
  </div>
  <div class="kpi">
    <div class="item">Ø­Ø§Ù„Øª: <strong id="modeLabel">Ù…Ø­Ù„ÛŒ</strong></div>
    <div class="item">Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§: <strong>20</strong></div>
    <div class="item status" id="status">Ø¢Ù…Ø§Ø¯Ù‡</div>
  </div>
</header>

<div class="row">
  <aside class="panel side">
    <div class="search">
      <input id="search" placeholder="Ø¬Ø³ØªØ¬ÙˆÛŒ Ø§Ø¨Ø²Ø§Ø±â€¦" />
    </div>

    <div class="tasks" id="tasks"></div>

    <div class="settings">
      <h3>ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ù…ÙˆØªÙˆØ±</h3>
      <label>Ø­Ø§Ù„Øª Ù…ÙˆØªÙˆØ±</label>
      <select id="engineMode">
        <option value="local">Ù…Ø­Ù„ÛŒ (Ø¨Ø¯ÙˆÙ† API)</option>
        <option value="openai">LLM Ø³Ø§Ø²Ú¯Ø§Ø± Ø¨Ø§ OpenAI (Ø§Ø®ØªÛŒØ§Ø±ÛŒ)</option>
      </select>
      <div id="llmFields" style="display:none">
        <label>Base URL</label>
        <input id="apiBase" placeholder="Ù…Ø«Ø§Ù„: https://api.openai.com" />
        <label>Model</label>
        <input id="apiModel" placeholder="Ù…Ø«Ø§Ù„: gpt-4o-mini" />
        <label>API Key</label>
        <input id="apiKey" placeholder="sk-..." />
      </div>
    </div>
  </aside>

  <main class="main">
    <div class="hero panel">
      <div class="inline" style="justify-content:space-between">
        <div class="chip">ğŸ§­ Ø±Ø§Ù‡Ù†Ù…Ø§: ÛŒÚ© Ø§Ø¨Ø²Ø§Ø± Ø±Ø§ Ø§Ø² Ø³ØªÙˆÙ† Ú†Ù¾ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯</div>
        <div class="inline" style="flex:none; gap:6px">
          <button class="btn secondary" id="exportBtn">Ø®Ø±ÙˆØ¬ÛŒ JSON</button>
          <button class="btn secondary" id="importBtn">ÙˆØ±ÙˆØ¯ JSON</button>
          <button class="btn secondary" id="clearBtn">Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ</button>
        </div>
      </div>
      <div class="sep"></div>
      <div class="notice">Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø¨Ø¯ÙˆÙ† Ú©Ù„ÛŒØ¯ Ù‡Ù… Ø§Ø² Ù†Ø³Ø®Ù‡â€ŒÛŒ Ù…Ø­Ù„ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯. Ø¨Ø±Ø§ÛŒ Ø¨Ù‡ØªØ±ÛŒÙ† Ù†ØªØ§ÛŒØ¬ Ø²Ø¨Ø§Ù†ÛŒ/Ø®Ù„Ø§Ù‚ÛŒØªØŒ ÛŒÚ© Ù…Ø¯Ù„ Ø³Ø§Ø²Ú¯Ø§Ø± Ø¨Ø§ OpenAI ØªÙ†Ø¸ÛŒÙ… Ú©Ù†ÛŒØ¯.</div>
    </div>

    <div class="grid">
      <div class="card">
        <h3>ÙˆØ±ÙˆØ¯ÛŒ</h3>
        <textarea id="inputText" placeholder="Ù…ØªÙ† Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯â€¦"></textarea>
        <div id="dynamicInputs" class="inline" style="margin-top:10px"></div>
      </div>

      <div class="card">
        <h3>Ø®Ø±ÙˆØ¬ÛŒ</h3>
        <div class="toolbar">
          <button class="btn secondary" id="copyBtn">Ú©Ù¾ÛŒ</button>
          <button class="btn secondary" id="downloadBtn">Ø¯Ø§Ù†Ù„ÙˆØ¯</button>
          <button class="btn" id="runBtn">Ø§Ø¬Ø±Ø§</button>
        </div>
        <div class="output" id="output"></div>
      </div>
    </div>

    <div class="card">
      <h3>ØªÙˆØ¶ÛŒØ­ Ø§Ø¨Ø²Ø§Ø±</h3>
      <div id="toolDesc" class="notice">ÛŒÚ© Ø§Ø¨Ø²Ø§Ø± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ ØªØ§ ØªÙ†Ø¸ÛŒÙ…Ø§ØªØ´ Ù†Ù…Ø§ÛŒØ´ Ø¯Ø§Ø¯Ù‡ Ø´ÙˆØ¯.</div>
    </div>

    <div class="footer">Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯Ù‡ Ø¨Ø§ Ø¹Ø´Ù‚ Ø¨Ù‡ Ø³Ø§Ø¯Ú¯ÛŒØŒ Ø®Ù„Ø§Ù‚ÛŒØª Ùˆ Ø­Ø§Ù„ Ø®ÙˆØ¨ Ø³Ø§Ø®ØªÙ† âœ¨</div>
  </main>
</div>

<script>
/* ---------- Data ---------- */
const TOOLS = [
  {id:'prompt_pro', name:'ØªÙˆÙ„ÛŒØ¯ Ù¾Ø±Ø§Ù…Ù¾Øª Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ', ico:'ğŸ§ª', desc:'Ø³Ø§Ø®Øª Ù¾Ø±Ø§Ù…Ù¾Øª Ø¯Ù‚ÛŒÙ‚ Ø¨Ø§ Ø³Ø§Ø®ØªØ§Ø± Ù†Ù‚Ø´ØŒ Ù‡Ø¯ÙØŒ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ùˆ Ù„Ø­Ù†.',
   inputs:[
     {id:'role', type:'text', label:'Ù†Ù‚Ø´ Ù…Ø¯Ù„', ph:'Ù…Ø«Ø§Ù„: Ú©Ø§Ø±Ø´Ù†Ø§Ø³ Ø¨Ø§Ø²Ø§Ø±ÛŒØ§Ø¨ÛŒ Ù…Ø­ØªÙˆØ§ÛŒÛŒ'},
     {id:'goal', type:'text', label:'Ù‡Ø¯Ù', ph:'Ù…Ø«Ø§Ù„: Ø§ÙØ²Ø§ÛŒØ´ Ù†Ø±Ø® ØªØ¨Ø¯ÛŒÙ„ ØµÙØ­Ù‡ Ù…Ø­ØµÙˆÙ„'},
     {id:'tone', type:'select', label:'Ù„Ø­Ù†', options:['Ø®Ù†Ø«ÛŒ','Ø±Ø³Ù…ÛŒ','Ø¯ÙˆØ³ØªØ§Ù†Ù‡','Ù‚Ø§Ù†Ø¹â€ŒÚ©Ù†Ù†Ø¯Ù‡','ØªØ®ØµØµÛŒ']},
     {id:'constraints', type:'text', label:'Ù‚ÛŒÙˆØ¯', ph:'Ù…Ø«Ø§Ù„: Ø­Ø¯Ø§Ú©Ø«Ø± 150 Ú©Ù„Ù…Ù‡ØŒ Ù†Ú©Ø§Øª Ø¨ÙˆÙ„Øªâ€ŒÙ¾ÙˆÛŒÙ†Øª'},
   ]},
  {id:'summarize', name:'Ø®Ù„Ø§ØµÙ‡â€ŒØ³Ø§Ø² Ù…ØªÙ†', ico:'ğŸ§¾', desc:'Ø®Ù„Ø§ØµÙ‡ ÙØ´Ø±Ø¯Ù‡ Ùˆ Ù†Ú©Ø§Øª Ú©Ù„ÛŒØ¯ÛŒ.',
   inputs:[
     {id:'ratio', type:'select', label:'Ø´Ø¯Øª Ø®Ù„Ø§ØµÙ‡', options:['Ù…Ù„Ø§ÛŒÙ…','Ù…ØªÙˆØ³Ø·','ÙØ´Ø±Ø¯Ù‡']},
     {id:'bullets', type:'select', label:'Ù†Ù…Ø§ÛŒØ´', options:['Ù¾Ø§Ø±Ø§Ú¯Ø±Ø§Ù','Ø¨ÙˆÙ„Øªâ€ŒÙ¾ÙˆÛŒÙ†Øª']}
   ]},
  {id:'paraphrase', name:'Ø¨Ø§Ø²Ù†ÙˆÛŒØ³ÛŒ Ø®Ù„Ø§Ù‚Ø§Ù†Ù‡', ico:'ğŸ¨', desc:'Ø¨Ø§Ø²Ù†ÙˆÛŒØ³ÛŒ Ø¨Ø§ Ø­ÙØ¸ Ù…Ø¹Ù†Ø§ Ùˆ Ø§ÙØ²Ø§ÛŒØ´ Ø±ÙˆØ§Ù†ÛŒ.',
   inputs:[ {id:'creativity', type:'select', label:'Ø®Ù„Ø§Ù‚ÛŒØª', options:['Ú©Ù…','Ù…ØªÙˆØ³Ø·','Ø²ÛŒØ§Ø¯']} ]},
  {id:'tone', name:'ØªØºÛŒÛŒØ± Ù„Ø­Ù†', ico:'ğŸšï¸', desc:'ØªØ¨Ø¯ÛŒÙ„ Ù„Ø­Ù† Ù…ØªÙ† (Ø±Ø³Ù…ÛŒ/Ø¯ÙˆØ³ØªØ§Ù†Ù‡/Ù‚Ø§Ù†Ø¹â€ŒÚ©Ù†Ù†Ø¯Ù‡/ØªØ®ØµØµÛŒ).',
   inputs:[ {id:'tone', type:'select', label:'Ù„Ø­Ù†', options:['Ø±Ø³Ù…ÛŒ','Ø¯ÙˆØ³ØªØ§Ù†Ù‡','Ù‚Ø§Ù†Ø¹â€ŒÚ©Ù†Ù†Ø¯Ù‡','ØªØ®ØµØµÛŒ']} ]},
  {id:'keywords', name:'Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ú©Ù„Ù…Ø§Øª Ú©Ù„ÛŒØ¯ÛŒ', ico:'ğŸ”‘', desc:'ÙˆØ§Ú˜Ú¯Ø§Ù† Ù…Ù‡Ù… Ùˆ Ø¹Ø¨Ø§Ø±Øªâ€ŒÙ‡Ø§ÛŒ Ú©Ù„ÛŒØ¯ÛŒ.',
   inputs:[ {id:'count', type:'number', label:'ØªØ¹Ø¯Ø§Ø¯', ph:'10'} ]},
  {id:'sentiment', name:'ØªØ­Ù„ÛŒÙ„ Ø§Ø­Ø³Ø§Ø³Ø§Øª', ico:'ğŸ’¡', desc:'Ù…Ø«Ø¨Øª/Ù…Ù†ÙÛŒ/Ø®Ù†Ø«ÛŒ + Ù†Ù…Ø±Ù‡.',
   inputs:[]},
  {id:'title', name:'ØªÙˆÙ„ÛŒØ¯ Ø¹Ù†ÙˆØ§Ù† Ø¬Ø°Ø§Ø¨', ico:'ğŸ·ï¸', desc:'Ûµ Ø¹Ù†ÙˆØ§Ù† Ú©ÙˆØªØ§Ù‡ Ùˆ Ú¯ÛŒØ±Ø§ØªØ±.',
   inputs:[ {id:'style', type:'select', label:'Ø³Ø¨Ú©', options:['Ø§Ú©ØªØ´Ø§ÙÛŒ','Ù…Ø³ØªÙ‚ÛŒÙ…','Ù„ÛŒØ³Øªâ€ŒÙˆØ§Ø±','Ø³ÙˆØ§Ù„ÛŒ','Ø§Ø­Ø³Ø§Ø³ÛŒ']} ]},
  {id:'outline', name:'Ø³Ø§Ø®ØªØ§Ø±Ø¯Ù‡ÛŒ (Outline)', ico:'ğŸ§±', desc:'Ø³Ø±ÙØµÙ„â€ŒÙ‡Ø§ Ùˆ Ø²ÛŒØ±Ø¨Ø®Ø´â€ŒÙ‡Ø§.',
   inputs:[ {id:'depth', type:'select', label:'Ø¹Ù…Ù‚', options:['Ú©ÙˆØªØ§Ù‡','Ù…ØªÙˆØ³Ø·','Ø¹Ù…ÛŒÙ‚']} ]},
  {id:'brainstorm', name:'Ø·ÙˆÙØ§Ù† ÙÚ©Ø±ÛŒ Ø§ÛŒØ¯Ù‡â€ŒÙ‡Ø§', ico:'âš¡', desc:'Û±Û° Ø§ÛŒØ¯Ù‡ Ú©Ø§Ø±Ø¨Ø±Ø¯ÛŒ.',
   inputs:[ {id:'angle', type:'select', label:'Ø±ÙˆÛŒÚ©Ø±Ø¯', options:['Ù†ÙˆØ¢ÙˆØ±Ø§Ù†Ù‡','Ø¹Ù…Ù„ÛŒ','Ú©Ù…â€ŒÙ‡Ø²ÛŒÙ†Ù‡','Ø¯Ø§Ø¯Ù‡â€ŒÙ…Ø­ÙˆØ±']} ]},
  {id:'qa', name:'Ù¾Ø±Ø³Ø´â€ŒÙˆÙ¾Ø§Ø³Ø® Ø§Ø² Ù…ØªÙ†', ico:'â“', desc:'Ù¾Ø§Ø³Ø® Ø§Ø³ØªØ®Ø±Ø§Ø¬ÛŒ Ø§Ø² Ù…ØªÙ†.',
   inputs:[ {id:'question', type:'text', label:'Ø³Ø¤Ø§Ù„', ph:'Ø³Ø¤Ø§Ù„ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯'} ]},
  {id:'translate', name:'ØªØ±Ø¬Ù…Ù‡ Ø³Ø±ÛŒØ¹ (ÙØ§â†”Ø§Ù†Ú¯)', ico:'ğŸŒ', desc:'ØªØ±Ø¬Ù…Ù‡ Ø³Ø¨Ú© Ùˆ Ø³Ø±ÛŒØ¹.',
   inputs:[ {id:'dir', type:'select', label:'Ø¬Ù‡Øª', options:['FAâ†’EN','ENâ†’FA']} ]},
  {id:'email', name:'ØªÙˆÙ„ÛŒØ¯ Ø§ÛŒÙ…ÛŒÙ„', ico:'âœ‰ï¸', desc:'Ø§ÛŒÙ…ÛŒÙ„ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ø¨Ø§ Ø³Ù„Ø§Ù… Ùˆ Ù¾Ø§ÛŒØ§Ù†.',
   inputs:[ {id:'purpose', type:'select', label:'Ù‡Ø¯Ù', options:['Ø¯Ø±Ø®ÙˆØ§Ø³Øª','Ù¾ÛŒÚ¯ÛŒØ±ÛŒ','Ù…Ø¹Ø±ÙÛŒ','Ø¹Ø°Ø±Ø®ÙˆØ§Ù‡ÛŒ','ØªØ¨Ø±ÛŒÚ©']} ]},
  {id:'img_prompt', name:'Ù¾Ø±Ø§Ù…Ù¾Øª ØªØµÙˆÛŒØ±', ico:'ğŸ–¼ï¸', desc:'Ù¾Ø±Ø§Ù…Ù¾Øª ØºÙ†ÛŒ Ø¨Ø±Ø§ÛŒ Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ ØªØµÙˆÛŒØ±ÛŒ.',
   inputs:[ {id:'style', type:'select', label:'Ø³Ø¨Ú©', options:['ÙˆØ§Ù‚Ø¹â€ŒÚ¯Ø±Ø§ÛŒØ§Ù†Ù‡','Ø³ÛŒÙ†Ù…Ø§ØªÛŒÚ©','Ù…ÛŒÙ†ÛŒÙ…Ø§Ù„','Ø§ÛŒØ²ÙˆÙ…ØªØ±ÛŒÚ©','Ø³ÙˆØ±Ø¦Ø§Ù„']} ]},
  {id:'tweet', name:'Ù¾Ø³Øª Ú©ÙˆØªØ§Ù‡/ØªÙˆÛŒÛŒØª', ico:'ğŸ¦', desc:'Û³ Ù†Ø³Ø®Ù‡ Ù…ØªÙØ§ÙˆØª Ø²ÛŒØ± Û²Û¸Û° Ú©Ø§Ø±Ø§Ú©ØªØ±.',
   inputs:[ {id:'vibe', type:'select', label:'Ø­Ø³â€ŒÙˆØ­Ø§Ù„', options:['Ø§Ø·Ù„Ø§Ø¹ÛŒ','Ø§Ù†Ú¯ÛŒØ²Ø´ÛŒ','ØªØ¹Ø§Ù…Ù„ÛŒ','Ø·Ù†Ø²']} ]},
  {id:'product', name:'ØªÙˆØ¶ÛŒØ­Ø§Øª Ù…Ø­ØµÙˆÙ„', ico:'ğŸ›’', desc:'ÙØ±ÙˆØ´â€ŒÙ…Ø­ÙˆØ± Ø¨Ø§ Ù…Ø²ÛŒØªâ€ŒÙ‡Ø§.',
   inputs:[ {id:'aud', type:'select', label:'Ù…Ø®Ø§Ø·Ø¨', options:['Ø¹Ù…ÙˆÙ…ÛŒ','B2B','ØªØ§Ø²Ù‡â€ŒÚ©Ø§Ø±','Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ']} ]},
  {id:'bullets', name:'Ù†Ú©Ø§Øª Ú©Ù„ÛŒØ¯ÛŒ Ø¨ÙˆÙ„Øªâ€ŒÙ¾ÙˆÛŒÙ†Øª', ico:'ğŸ“Œ', desc:'Ûµ-Û¸ Ú¯Ù„ÙˆÙ„Ù‡ Ø®Ù„Ø§ØµÙ‡.',
   inputs:[]},
  {id:'checklist', name:'Ú†Ú©â€ŒÙ„ÛŒØ³Øª Ø§Ø² Ù…ØªÙ†', ico:'â˜‘ï¸', desc:'Ú©Ø§Ø±Ù‡Ø§ÛŒ Ø§Ù†Ø¬Ø§Ù…â€ŒØ¯Ø§Ø¯Ù†ÛŒ Ù‚Ø§Ø¨Ù„ ØªÛŒÚ©.',
   inputs:[]},
  {id:'naming', name:'Ù†Ø§Ù…â€ŒÚ¯Ø°Ø§Ø±ÛŒ Ø¨Ø±Ù†Ø¯/Ù…Ø­ØµÙˆÙ„', ico:'ğŸ§©', desc:'Û±Û° Ù†Ø§Ù… + Ù…Ø¹ÛŒØ§Ø± Ø§Ù†ØªØ®Ø§Ø¨.',
   inputs:[ {id:'flavor', type:'select', label:'Ø·Ø¹Ù… Ø¨Ø±Ù†Ø¯', options:['Ù¾Ø±ÛŒÙ…ÛŒÙˆÙ…','Ø¯ÙˆØ³ØªØ§Ù†Ù‡','ÙÙ†Ø§ÙˆØ±Ø§Ù†Ù‡','Ø®Ù„Ø§Ù‚']} ]},
  {id:'ner', name:'Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ù…ÙˆØ¬ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§', ico:'ğŸ§­', desc:'Ù†Ø§Ù…â€ŒÙ‡Ø§ØŒ Ø³Ø§Ø²Ù…Ø§Ù†â€ŒÙ‡Ø§ØŒ ØªØ§Ø±ÛŒØ®â€ŒÙ‡Ø§.',
   inputs:[]},
  {id:'classify', name:'Ø·Ø¨Ù‚Ù‡â€ŒØ¨Ù†Ø¯ÛŒ Ø¨Ø§ Ø¨Ø±Ú†Ø³Ø¨ Ø³ÙØ§Ø±Ø´ÛŒ', ico:'ğŸ·ï¸', desc:'Ø§Ù†ØªØ®Ø§Ø¨ Ø¨Ø±Ú†Ø³Ø¨ Ø¨Ø± Ø§Ø³Ø§Ø³ Ú©Ù„ÛŒØ¯ÙˆØ§Ú˜Ù‡â€ŒÙ‡Ø§.',
   inputs:[ {id:'labels', type:'text', label:'Ø¨Ø±Ú†Ø³Ø¨â€ŒÙ‡Ø§ (label:Ú©Ù„Ù…Ø§Øª)', ph:'Ù…Ø«Ø§Ù„: Ù…Ø«Ø¨Øª:Ø®ÙˆØ¨ØŒØ¹Ø§Ù„ÛŒ | Ù…Ù†ÙÛŒ:Ø¨Ø¯ØŒØ¶Ø¹ÛŒÙ'} ]},
];

/* ---------- DOM ---------- */
const tasksEl = document.getElementById('tasks');
const searchEl = document.getElementById('search');
const inputTextEl = document.getElementById('inputText');
const dynamicInputsEl = document.getElementById('dynamicInputs');
const toolDescEl = document.getElementById('toolDesc');
const outputEl = document.getElementById('output');
const runBtn = document.getElementById('runBtn');
const copyBtn = document.getElementById('copyBtn');
const downloadBtn = document.getElementById('downloadBtn');
const exportBtn = document.getElementById('exportBtn');
const importBtn = document.getElementById('importBtn');
const clearBtn = document.getElementById('clearBtn');
const engineModeEl = document.getElementById('engineMode');
const llmFieldsEl = document.getElementById('llmFields');
const apiBaseEl = document.getElementById('apiBase');
const apiModelEl = document.getElementById('apiModel');
const apiKeyEl = document.getElementById('apiKey');
const modeLabelEl = document.getElementById('modeLabel');
const statusEl = document.getElementById('status');

let state = { tool: TOOLS[0].id, inputs: {}, history: [] };

/* ---------- UI Builders ---------- */
function renderTaskList(filter=''){
  tasksEl.innerHTML = '';
  TOOLS.filter(t => (t.name+t.desc).includes(filter)).forEach(t=>{
    const d = document.createElement('button');
    d.className = 'task' + (state.tool===t.id? ' active':'');
    d.innerHTML = `
      <div class="ico">${t.ico}</div>
      <div>
        <div class="name">${t.name}</div>
        <div class="desc">${t.desc}</div>
      </div>`;
    d.onclick=()=>{ state.tool = t.id; renderTaskList(searchEl.value); renderDynamicInputs(); outputEl.textContent=''; toolDescEl.textContent=t.desc; };
    tasksEl.appendChild(d);
  });
}
function renderDynamicInputs(){
  dynamicInputsEl.innerHTML = '';
  const tool = TOOLS.find(x=>x.id===state.tool);
  toolDescEl.textContent = tool.desc;
  (tool.inputs||[]).forEach(inp=>{
    const wrap = document.createElement('div'); wrap.style.flex='1';
    const label = document.createElement('label'); label.textContent = inp.label; label.style.display='block'; label.style.fontSize='12px'; label.style.color='var(--sub)';
    let el;
    if(inp.type==='select'){
      el = document.createElement('select');
      inp.options.forEach(o=>{ const opt=document.createElement('option'); opt.value=o; opt.textContent=o; el.appendChild(opt);});
    }else if(inp.type==='number'){
      el = document.createElement('input'); el.type='number'; el.placeholder=inp.ph||'';
    }else{
      el = document.createElement('input'); el.type='text'; el.placeholder=inp.ph||'';
    }
    el.value = state.inputs[inp.id] || '';
    el.oninput = (e)=>{ state.inputs[inp.id]=e.target.value; };
    wrap.appendChild(label); wrap.appendChild(el);
    dynamicInputsEl.appendChild(wrap);
  });
}
function setStatus(msg){ statusEl.textContent = msg; }

/* ---------- Helpers (Local Heuristics) ---------- */
const stopWordsFA = 'Ø§Ø² Ø±Ø§ Ú©Ù‡ Ø¨Ù‡ Ø¨Ø±Ø§ÛŒ Ùˆ Ø¯Ø± Ø¨Ø§ Ø§ÛŒÙ† Ø¢Ù† ÛŒÚ© Ù‡Ø§ÛŒ Ù…ÛŒ Ø¨Ø± ØªØ§ Ø§Ù…Ø§ Ø§Ú¯Ø± Ø§Ø³Øª Ø¨ÛŒÙ† ÛŒØ§ Ù‡Ø§ Ø´Ø¯Ù† Ú©Ø±Ø¯Ù† Ø´Ø¯Ù†Ù Ø´Ø¯Ù†ÙÛŒ Ú†ÙˆÙ† Ø²ÛŒØ±Ø§ ÙˆÙ‚ØªÛŒ Ù‡Ø± Ù†ÛŒØ² Ú†Ø±Ø§ Ø²ÛŒØ±Ø§ Ù„Ø°Ø§ Ø¨Ù„Ú©Ù‡ Ø¨Ø§ÛŒØ¯ Ø¨ÙˆØ¯Ù‡ Ø¨ÙˆØ¯Ù†Ø¯ Ø¨ÙˆØ¯Ù‡â€ŒØ§Ù… Ù†Ù…ÙˆØ¯'.split(' ');
const stopWordsEN = 'the a an of in on at to for and or is are be been by with from as this that those these it its into over under while if so because therefore hence but not only just very really about around across'.split(' ');

function sents(text){
  return text.split(/(?<=[.!ØŸ\?\n])\s+/).map(s=>s.trim()).filter(Boolean);
}
function words(text){
  return text.toLowerCase().replace(/[^\p{L}\p{N}\s\-]/gu,' ').split(/\s+/).filter(Boolean);
}
function topKeywords(text, k=10){
  const ws = words(text).filter(w=>!stopWordsFA.includes(w)&&!stopWordsEN.includes(w));
  const freq = {}; ws.forEach(w=>freq[w]=(freq[w]||0)+1);
  return Object.entries(freq).sort((a,b)=>b[1]-a[1]).slice(0,k).map(([w,c])=>({w,c}));
}
function summarize(text, level='Ù…ØªÙˆØ³Ø·', bullets=false){
  const ss = sents(text);
  if(ss.length<=3) return bullets? 'â€¢ '+ss.join('\nâ€¢ '): ss.join(' ');
  const kws = topKeywords(text, 12).map(x=>x.w);
  const score = s=>kws.reduce((acc,k)=>acc+(s.toLowerCase().includes(k)?1:0),0)+(s.length<140?0.2:0);
  const ranked = ss.map(s=>({s,score:score(s)})).sort((a,b)=>b.score-a.score);
  const pick = level==='ÙØ´Ø±Ø¯Ù‡'? Math.max(3, Math.round(ss.length*0.2))
              : level==='Ù…Ù„Ø§ÛŒÙ…'? Math.max(3, Math.round(ss.length*0.5))
              : Math.max(4, Math.round(ss.length*0.33));
  const chosen = ranked.slice(0,pick).map(o=>o.s);
  return bullets? 'â€¢ '+chosen.join('\nâ€¢ ') : chosen.join(' ');
}
function paraphrase(text, creativity='Ù…ØªÙˆØ³Ø·'){
  // Ø³Ø§Ø¯Ù‡: Ø¬Ø§Ø¨Ù‡â€ŒØ¬Ø§ÛŒÛŒØŒ Ù‡Ù…â€ŒÙ…Ø¹Ù†ÛŒâ€ŒÙ‡Ø§ÛŒ Ø±Ø§ÛŒØ¬ØŒ Ú©ÙˆØªØ§Ù‡â€ŒØ³Ø§Ø²ÛŒ
  const map = {
    'Ø§Ø³Øª':'Ù…ÛŒâ€ŒØ¨Ø§Ø´Ø¯', 'Ù…ÛŒâ€ŒØ¨Ø§Ø´Ø¯':'Ø§Ø³Øª', 'Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯':'Ù‚Ø§Ø¯Ø± Ø§Ø³Øª', 'Ø¨Ø³ÛŒØ§Ø±':'Ø®ÛŒÙ„ÛŒ',
    'Ù…Ù‡Ù…':'Ú©Ù„ÛŒØ¯ÛŒ', 'Ø²ÛŒØ±Ø§':'Ú†ÙˆÙ†', 'Ø§Ù…Ø§':'Ø¨Ø§ Ø§ÛŒÙ† Ø­Ø§Ù„', 'Ú©Ø§Ø±Ø¨Ø±Ø¯ÛŒ':'Ø¹Ù…Ù„ÛŒ', 'Ú†Ø§Ù„Ø´':'Ù…Ø³Ø£Ù„Ù‡'
  };
  let out = text.replace(/\b\w+\b/gu, (w)=>{
    if(Math.random()< (creativity==='Ø²ÛŒØ§Ø¯'?0.25:creativity==='Ú©Ù…'?0.05:0.12) && map[w]) return map[w];
    return w;
  });
  // Ú©ÙˆØªØ§Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¬Ù…Ù„Ø§Øª Ø¨Ù„Ù†Ø¯
  out = sents(out).map(s=>{
    if(s.length>220) return s.replace(/ØŒ/g,'ØŒ ').split('ØŒ ').slice(0,3).join('ØŒ ')+'â€¦';
    return s;
  }).join(' ');
  return out;
}
function changeTone(text, tone){
  const pre = {
    'Ø±Ø³Ù…ÛŒ':'Ø¨Ø§ Ù„Ø­Ù† Ø±Ø³Ù…ÛŒ Ùˆ Ù†ÙˆØ´ØªØ§Ø±ÛŒ:',
    'Ø¯ÙˆØ³ØªØ§Ù†Ù‡':'Ø¨Ø§ Ù„Ø­Ù† Ø¯ÙˆØ³ØªØ§Ù†Ù‡ØŒ ØµÙ…ÛŒÙ…ÛŒ Ùˆ Ø±ÙˆØ§Ù†:',
    'Ù‚Ø§Ù†Ø¹â€ŒÚ©Ù†Ù†Ø¯Ù‡':'Ø¨Ø§ Ù„Ø­Ù† Ù‚Ø§Ù†Ø¹â€ŒÚ©Ù†Ù†Ø¯Ù‡ Ùˆ Ù†ØªÛŒØ¬Ù‡â€ŒÙ…Ø­ÙˆØ±:',
    'ØªØ®ØµØµÛŒ':'Ø¨Ø§ Ù„Ø­Ù† ØªØ®ØµØµÛŒ Ùˆ Ø¯Ù‚ÛŒÙ‚:'
  }[tone]||'';
  return `${pre}\n${paraphrase(text,'Ú©Ù…')}`;
}
function sentiment(text){
  const pos = ['Ø¹Ø§Ù„ÛŒ','Ø®ÙˆØ¨','Ù…ÙˆÙÙ‚','Ø¨Ø±ØªØ±','Ø¯ÙˆØ³Øªâ€ŒØ¯Ø§Ø´ØªÙ†ÛŒ','Ø´Ø§Ø¯','Ø±Ø§Ø¶ÛŒ','Ø¨Ù‡Ø¨ÙˆØ¯','Ø³Ø±ÛŒØ¹','Ú©Ø§Ø±Ø¢Ù…Ø¯','recommend','great','good','love','happy','win','fast','efficient'];
  const neg = ['Ø¨Ø¯','Ø¶Ø¹ÛŒÙ','Ù…Ø´Ú©Ù„','Ø®Ø±Ø§Ø¨','Ù†Ø§Ø±Ø§Ø¶ÛŒ','Ú©ÙÙ†Ø¯','Ú¯Ø±ÙˆÙ†','Ù†Ø§Ø§Ù…ÛŒØ¯','Ù†ÙØ±Øª','Ø¨Ø¯ØªØ±','error','bug','slow','hate','fail','expensive'];
  const t = text.toLowerCase();
  let p=0,n=0;
  pos.forEach(k=>{ if(t.includes(k.toLowerCase())) p++; });
  neg.forEach(k=>{ if(t.includes(k.toLowerCase())) n++; });
  const score = (p - n) / Math.max(1, p+n);
  const label = score>0.15? 'Ù…Ø«Ø¨Øª' : score<-0.15? 'Ù…Ù†ÙÛŒ' : 'Ø®Ù†Ø«ÛŒ';
  return {label, score: Number(score.toFixed(2)), pos:p, neg:n};
}
function title5(text, style){
  const base = topKeywords(text,6).map(x=>x.w);
  const hook = {
    'Ø§Ú©ØªØ´Ø§ÙÛŒ':'Ø¢Ù†Ú†Ù‡ Ø¨Ø§ÛŒØ¯ Ø¨Ø¯Ø§Ù†ÛŒØ¯',
    'Ù…Ø³ØªÙ‚ÛŒÙ…':'Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø¬Ø§Ù…Ø¹',
    'Ù„ÛŒØ³Øªâ€ŒÙˆØ§Ø±':'Û±Û° Ù†Ú©ØªÙ‡ Ø·Ù„Ø§ÛŒÛŒ',
    'Ø³ÙˆØ§Ù„ÛŒ':'Ú†Ø·ÙˆØ± Ùˆ Ú†Ø±Ø§',
    'Ø§Ø­Ø³Ø§Ø³ÛŒ':'Ø±Ø§Ø²Ù‡Ø§ÛŒÛŒ Ú©Ù‡ Ú©Ø³ÛŒ Ù†Ù…ÛŒâ€ŒÚ¯ÙˆÛŒØ¯'
  }[style]||'Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø±Ø¯ÛŒ';
  const caps = s=>s.replace(/\b\w/g, c=>c.toUpperCase());
  const head = caps(base.slice(0,2).join(' '));
  return [
    `${head}: ${hook}`,
    `${hook} Ø¯Ø±Ø¨Ø§Ø±Ù‡ ${base.slice(0,1)[0]||'Ù…ÙˆØ¶ÙˆØ¹ Ø´Ù…Ø§'}`,
    `Ø§Ø² ØµÙØ± ØªØ§ ØµØ¯ ${base.slice(0,2).join(' ')||'Ù…ÙˆØ¶ÙˆØ¹'}`,
    `${base.slice(0,1)[0]||'Ø§ÛŒØ¯Ù‡â€ŒÙ‡Ø§'} Ø¯Ø± Ø¹Ù…Ù„: ${hook}`,
    `Ú†Ø·ÙˆØ± ${base.slice(0,1)[0]||'Ù‡Ø¯Ù'} Ø±Ø§ Ø³Ø±ÛŒØ¹â€ŒØªØ± Ù…Ø­Ù‚Ù‚ Ú©Ù†ÛŒÙ…`
  ].map(x=>x.replace(/\s+/g,' ').trim());
}
function outline(text, depth='Ù…ØªÙˆØ³Ø·'){
  const ks = topKeywords(text,8).map(x=>x.w);
  const H2 = ks.slice(0,4).map((k,i)=>`${i+1}. ${k}`);
  const h3 = (k)=>['ØªØ¹Ø±ÛŒÙ Ùˆ Ø§Ù‡Ù…ÛŒØª','Ø±ÙˆØ´â€ŒÙ‡Ø§','Ù†Ù…ÙˆÙ†Ù‡â€ŒÙ‡Ø§','Ú†Ø§Ù„Ø´â€ŒÙ‡Ø§','Ø¬Ù…Ø¹â€ŒØ¨Ù†Ø¯ÛŒ'];
  const lines = [];
  H2.forEach((h,idx)=>{
    lines.push(`Ø¨Ø®Ø´ ${idx+1}: ${h.replace(/^\d+\. /,'')}`);
    const subs = depth==='Ø¹Ù…ÛŒÙ‚'? h3().concat(['Ù…Ù†Ø§Ø¨Ø¹','Ú†Ú©â€ŒÙ„ÛŒØ³Øª'])
               : depth==='Ú©ÙˆØªØ§Ù‡'? h3().slice(0,3)
               : h3();
    subs.forEach(s=>lines.push(`  - ${s}`));
  });
  return lines.join('\n');
}
function ideas(text, angle='Ù†ÙˆØ¢ÙˆØ±Ø§Ù†Ù‡'){
  const base = topKeywords(text,5).map(x=>x.w);
  const tag = angle==='Ø¹Ù…Ù„ÛŒ'? 'Ú©Ù…â€ŒØ±ÛŒØ³Ú©' : angle==='Ú©Ù…â€ŒÙ‡Ø²ÛŒÙ†Ù‡'? 'Ø§Ø±Ø²Ø§Ù†' : angle==='Ø¯Ø§Ø¯Ù‡â€ŒÙ…Ø­ÙˆØ±'? 'Data-driven' : 'Ù†ÙˆØ¢ÙˆØ±Ø§Ù†Ù‡';
  return Array.from({length:10}, (_,i)=>`${i+1}. Ø§ÛŒØ¯Ù‡ ${tag}: Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² ${base[i%base.length]||'Ù†Ú©ØªÙ‡'} Ø¨Ø±Ø§ÛŒ Ø®Ù„Ù‚ Ø§Ø±Ø²Ø´`).join('\n');
}
function qa(text, question){
  const qs = words(question).filter(w=>!stopWordsFA.includes(w)&&!stopWordsEN.includes(w));
  const ss = sents(text);
  const score = (s)=>qs.reduce((a,k)=>a+(s.toLowerCase().includes(k)?1:0),0);
  const best = ss.map(s=>({s,score:score(s)})).sort((a,b)=>b.score-a.score)[0];
  return best && best.score>0? best.s : 'Ù¾Ø§Ø³Ø® ØµØ±ÛŒØ­ÛŒ Ø¯Ø± Ù…ØªÙ† ÛŒØ§ÙØª Ù†Ø´Ø¯. Ø´Ø§ÛŒØ¯ Ù„Ø§Ø²Ù… Ø§Ø³Øª Ù…ØªÙ† Ø¨ÛŒØ´ØªØ±ÛŒ Ø¨Ø¯Ù‡ÛŒØ¯.';
}
function translate(text, dir){
  // Ø¨Ø³ÛŒØ§Ø± Ø³Ø§Ø¯Ù‡ Ùˆ Ø³Ø¨Ú© â€” Ø¨Ø±Ø§ÛŒ Ú©ÛŒÙÛŒØª Ø¨Ø§Ù„Ø§ Ø§Ø² Ø­Ø§Ù„Øª LLM Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯
  const dictFAEN = {'Ø³Ù„Ø§Ù…':'hello','Ø¯Ù†ÛŒØ§':'world','Ù…Ø­ØµÙˆÙ„':'product','Ú©Ø§Ø±Ø¨Ø±':'user','Ø³Ø±Ø¹Øª':'speed','Ú©ÛŒÙÛŒØª':'quality','Ø®Ø¯Ù…Ø§Øª':'service','Ù‚ÛŒÙ…Øª':'price','Ø¨Ø§Ø²Ø§Ø±':'market','Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ':'artificial intelligence','Ø¯Ø§Ø¯Ù‡':'data','ØªØ­Ù„ÛŒÙ„':'analysis'};
  if(dir==='FAâ†’EN'){
    let out = text;
    Object.entries(dictFAEN).forEach(([fa,en])=>{
      out = out.replace(new RegExp(fa,'g'), en);
    });
    return out.split(' ').map(w=>w==='Ùˆ'?',':w).join(' ');
  }else{
    let out = text.toLowerCase();
    Object.entries(dictFAEN).forEach(([fa,en])=>{
      out = out.replace(new RegExp(`\\b${en}\\b`,'g'), fa);
    });
    return out.replace(/, /g,' Ùˆ ').replace(/\bthe\b/g,'').trim();
  }
}
function email(text, purpose){
  const greet = 'Ø³Ù„Ø§Ù… Ùˆ Ø§Ø­ØªØ±Ø§Ù…ØŒ';
  const end = 'Ø¨Ø§ Ø³Ù¾Ø§Ø³\n[Ù†Ø§Ù… Ø´Ù…Ø§]';
  const purposeLine = {
    'Ø¯Ø±Ø®ÙˆØ§Ø³Øª':'Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø¯Ø§Ø±Ù… Ø¯Ø± Ø®ØµÙˆØµ Ù…ÙˆØ¶ÙˆØ¹ Ø²ÛŒØ± Ù‡Ù…Ú©Ø§Ø±ÛŒ Ø¨ÙØ±Ù…Ø§ÛŒÛŒØ¯:',
    'Ù¾ÛŒÚ¯ÛŒØ±ÛŒ':'Ø¯Ø± Ø§Ø¯Ø§Ù…Ù‡â€ŒÛŒ Ù…Ú©Ø§ØªØ¨Ø§Øª Ù‚Ø¨Ù„ÛŒØŒ Ù¾ÛŒÚ¯ÛŒØ± ÙˆØ¶Ø¹ÛŒØª Ù…ÙˆØ¶ÙˆØ¹ Ø²ÛŒØ± Ù‡Ø³ØªÙ…:',
    'Ù…Ø¹Ø±ÙÛŒ':'Ù…Ø§ÛŒÙ„Ù… Ù…ÙˆØ±Ø¯ Ø²ÛŒØ± Ø±Ø§ Ù…Ø¹Ø±ÙÛŒ Ú©Ù†Ù…:',
    'Ø¹Ø°Ø±Ø®ÙˆØ§Ù‡ÛŒ':'Ø¨Ø±Ø§ÛŒ Ù…ÙˆØ§Ø±Ø¯ Ø±Ø®â€ŒØ¯Ø§Ø¯Ù‡ Ù¾ÙˆØ²Ø´ Ù…ÛŒâ€ŒØ·Ù„Ø¨Ù…. Ø¬Ø²Ø¦ÛŒØ§Øª:',
    'ØªØ¨Ø±ÛŒÚ©':'ØªØ¨Ø±ÛŒÚ© ØµÙ…ÛŒÙ…Ø§Ù†Ù‡ Ø¨Ø§Ø¨Øª Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø®ÛŒØ± Ø´Ù…Ø§! Ú†Ù†Ø¯ Ù†Ú©ØªÙ‡:'
  }[purpose] || 'Ø¯Ø± Ø®ØµÙˆØµ Ù…ÙˆØ¶ÙˆØ¹ Ø²ÛŒØ±:';
  return `${greet}\n${purposeLine}\n\n${text}\n\nØ§Ú¯Ø± Ù†Ú©ØªÙ‡â€ŒØ§ÛŒ Ù‡Ø³Øª Ø®ÙˆØ´Ø­Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆÙ… Ø¨Ø¯Ø§Ù†Ù….\n${end}`;
}
function imgPrompt(text, style){
  const details = ['lighting: soft', 'high detail', 'rich colors', 'ultra realistic', 'sharp focus', 'depth of field'];
  const aspect = 'â€“ar 3:2';
  const s = {
    'ÙˆØ§Ù‚Ø¹â€ŒÚ¯Ø±Ø§ÛŒØ§Ù†Ù‡':'photorealistic, 50mm lens',
    'Ø³ÛŒÙ†Ù…Ø§ØªÛŒÚ©':'cinematic, anamorphic, moody lighting',
    'Ù…ÛŒÙ†ÛŒÙ…Ø§Ù„':'minimal, clean composition, negative space',
    'Ø§ÛŒØ²ÙˆÙ…ØªØ±ÛŒÚ©':'isometric, vector, crisp lines',
    'Ø³ÙˆØ±Ø¦Ø§Ù„':'surreal, dreamlike, unexpected juxtapositions'
  }[style] || 'stylized';
  return `Subject: ${text}\nStyle: ${s}\nDetails: ${details.slice(0,4).join(', ')}\nQuality: 8k, HDR ${aspect}`;
}
function tweet(text, vibe){
  const tags = topKeywords(text,4).map(k=>'#'+k).join(' ');
  const tones = {
    'Ø§Ø·Ù„Ø§Ø¹ÛŒ':'Ø®Ø¨Ø± Ú©ÙˆØªØ§Ù‡',
    'Ø§Ù†Ú¯ÛŒØ²Ø´ÛŒ':'ÛŒÚ© Ù‚Ø¯Ù… Ø¨Ø±Ø¯Ø§Ø±',
    'ØªØ¹Ø§Ù…Ù„ÛŒ':'Ù†Ø¸Ø± ØªÙˆ Ú†ÛŒÙ‡ØŸ',
    'Ø·Ù†Ø²':'Ù„Ø¨Ø®Ù†Ø¯ Ø¨Ø²Ù†'
  };
  const base = tones[vibe] || 'Ø­Ø³ Ø®ÙˆØ¨';
  const variants = [
    `${base}: ${text}`.slice(0,240),
    `${text} â€” ${tags}`.slice(0,260),
    `${base} | ${tags} | ${text}`.slice(0,270)
  ];
  return variants.map((t,i)=>`[${i+1}] ${t}`).join('\n');
}
function productDesc(text, aud){
  const bullets = [
    'Ù…Ø²ÛŒØª Ú©Ù„ÛŒØ¯ÛŒ Û±: '+ (topKeywords(text,1)[0]?.w || 'Ú©ÛŒÙÛŒØª Ø¨Ø§Ù„Ø§'),
    'Ù…Ø²ÛŒØª Ú©Ù„ÛŒØ¯ÛŒ Û²: '+ (topKeywords(text,2)[1]?.w || 'Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¢Ø³Ø§Ù†'),
    'Ù…Ø²ÛŒØª Ú©Ù„ÛŒØ¯ÛŒ Û³: '+ (topKeywords(text,3)[2]?.w || 'ØµØ±ÙÙ‡â€ŒØ¬ÙˆÛŒÛŒ Ø¯Ø± Ø²Ù…Ø§Ù†')
  ];
  const tone = aud==='B2B'?'Ø±Ø³Ù…ÛŒ Ùˆ Ù…Ø¨ØªÙ†ÛŒ Ø¨Ø± Ø§Ø±Ø²Ø´ ØªØ¬Ø§Ø±ÛŒ':
               aud==='ØªØ§Ø²Ù‡â€ŒÚ©Ø§Ø±'?'Ø³Ø§Ø¯Ù‡ Ùˆ Ø¢Ù…ÙˆØ²Ø´ÛŒ':
               aud==='Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ'?'ØªØ®ØµØµÛŒ Ùˆ Ø¯Ù‚ÛŒÙ‚':'Ø¹Ù…ÙˆÙ…ÛŒ Ùˆ Ø±ÙˆØ§Ù†';
  return `Ø¨Ø±Ø§ÛŒ Ù…Ø®Ø§Ø·Ø¨ ${aud} Ø¨Ø§ Ù„Ø­Ù† ${tone}:\n${text}\n\nÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§:\n- ${bullets.join('\n- ')}`;
}
function bullets(text){
  const ks = topKeywords(text,8).map(x=>x.w);
  const ss = sents(text);
  const picks = ss.slice(0,2).concat(ss.filter(s=>ks.some(k=>s.toLowerCase().includes(k))).slice(0,6));
  const uniq = Array.from(new Set(picks));
  return uniq.map(s=>'â€¢ '+s).join('\n');
}
function checklist(text){
  const ks = topKeywords(text,10).map(x=>x.w);
  const ss = sents(text);
  const items = ss.filter(s=>/Ø¨Ø§ÛŒØ¯|Ø­ØªÙ…Ø§Ù‹|Ù…Ø±Ø­Ù„Ù‡|Ú¯Ø§Ù…|Ù†Ú©ØªÙ‡|Ø§Ø¬Ø±Ø§|Ø§Ù†Ø¬Ø§Ù…/u.test(s) || ks.some(k=>s.toLowerCase().includes(k))).slice(0,10);
  return items.map(s=>`[ ] ${s.replace(/[.!ØŸ]$/,'')}`).join('\n');
}
function naming(text, flavor){
  const base = topKeywords(text,6).map(x=>x.w);
  const add = {'Ù¾Ø±ÛŒÙ…ÛŒÙˆÙ…':'lux','Ø¯ÙˆØ³ØªØ§Ù†Ù‡':'buddy','ÙÙ†Ø§ÙˆØ±Ø§Ù†Ù‡':'nova','Ø®Ù„Ø§Ù‚':'spark'}[flavor]||'core';
  const names = Array.from({length:10},(_,i)=>{
    const a = base[i%base.length]||'nova';
    const b = add;
    return (a.slice(0,6)+b).replace(/[^a-zA-Z\u0600-\u06FF]/g,'');
  });
  const criteria = '- Ú©ÙˆØªØ§Ù‡ Ùˆ Ø¨Ù‡â€ŒÛŒØ§Ø¯Ù…Ø§Ù†Ø¯Ù†ÛŒ\n- Ù‚Ø§Ø¨Ù„ Ø«Ø¨Øª Ø¯Ø§Ù…Ù†Ù‡\n- Ø¨Ø¯ÙˆÙ† Ø¨Ø§Ø± Ù…Ù†ÙÛŒ ÙØ±Ù‡Ù†Ú¯ÛŒ\n- ØªÙ„ÙØ¸ Ø¢Ø³Ø§Ù†';
  return names.map((n,i)=>`${i+1}. ${n}`).join('\n') + `\n\nÙ…Ø¹ÛŒØ§Ø± Ø§Ù†ØªØ®Ø§Ø¨:\n${criteria}`;
}
function ner(text){
  const names = Array.from(text.matchAll(/\b([A-Z][a-z]+(?:\s[A-Z][a-z]+)*)\b/g)).map(m=>m[0]);
  const dates = Array.from(text.matchAll(/\b(20\d{2}|13\d{2}|14\d{2})\b/g)).map(m=>m[0]);
  const orgs = Array.from(text.matchAll(/\b([A-Z]{2,})\b/g)).map(m=>m[0]);
  return `Ù†Ø§Ù…â€ŒÙ‡Ø§: ${Array.from(new Set(names)).slice(0,10).join(', ')||'-'}\nØ³Ø§Ø²Ù…Ø§Ù†â€ŒÙ‡Ø§: ${Array.from(new Set(orgs)).slice(0,10).join(', ')||'-'}\nØªØ§Ø±ÛŒØ®/Ø³Ø§Ù„: ${Array.from(new Set(dates)).slice(0,10).join(', ')||'-'}`;
}
function classify(text, labelsStr){
  // ÙØ±Ù…Øª: Ù…Ø«Ø¨Øª:Ø®ÙˆØ¨ØŒØ¹Ø§Ù„ÛŒ | Ù…Ù†ÙÛŒ:Ø¨Ø¯ØŒØ¶Ø¹ÛŒÙ
  const labels = labelsStr.split('|').map(s=>s.trim()).filter(Boolean).map(pair=>{
    const [lab, keys] = pair.split(':').map(x=>x.trim());
    const arr = (keys||'').split(/[ØŒ,]/).map(x=>x.trim()).filter(Boolean);
    return {lab, arr};
  });
  const t = text.toLowerCase();
  const scored = labels.map(l=>({label:l.lab, score: l.arr.reduce((a,k)=>a+(t.includes(k.toLowerCase())?1:0),0)}));
  const best = scored.sort((a,b)=>b.score-a.score)[0];
  if(!best || best.score===0) return 'Ø¨Ø±Ú†Ø³Ø¨ Ù‚Ø·Ø¹ÛŒ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯.';
  return `Ø¨Ø±Ú†Ø³Ø¨: ${best.label} (Ø§Ù…ØªÛŒØ§Ø²: ${best.score})`;
}

/* ---------- LLM Bridge (OpenAI-compatible) ---------- */
async function callLLM({system, instruction, text}){
  const base = (apiBaseEl.value||'').replace(/\/$/,'');
  const model = apiModelEl.value;
  const key = apiKeyEl.value;
  if(!base || !model || !key) throw new Error('Missing LLM config');
  const body = {
    model,
    messages: [
      {role:'system', content: system},
      {role:'user', content: `${instruction}\n\n---\n${text}`}
    ],
    temperature: 0.4
  };
  const res = await fetch(`${base}/v1/chat/completions`, {
    method:'POST',
    headers:{'Content-Type':'application/json','Authorization':`Bearer ${key}`},
    body: JSON.stringify(body)
  });
  if(!res.ok){
    const t = await res.text();
    throw new Error(`HTTP ${res.status}: ${t}`);
  }
  const data = await res.json();
  return data.choices?.[0]?.message?.content?.trim() || '';
}

/* ---------- Runner ---------- */
async function run(){
  const tool = TOOLS.find(x=>x.id===state.tool);
  const text = (inputTextEl.value||'').trim();
  setStatus('Ø¯Ø± Ø­Ø§Ù„ Ø§Ø¬Ø±Ø§â€¦');
  outputEl.textContent='Ø¯Ø± Ø­Ø§Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´â€¦';
  const mode = engineModeEl.value;
  let out = '';
  try{
    if(mode==='local'){
      out = runLocal(tool, text);
    }else{
      const {system, instruction} = promptForTool(tool, state.inputs);
      out = await callLLM({system, instruction, text});
    }
    outputEl.textContent = out;
    setStatus('Ø¢Ù…Ø§Ø¯Ù‡');
    state.history.push({time:Date.now(), tool:tool.id, input:text, inputs:{...state.inputs}, output:out});
  }catch(e){
    outputEl.textContent = 'Ø®Ø·Ø§: '+ e.message;
    setStatus('Ø®Ø·Ø§');
  }
}
/* ---------- Prompts for LLM Mode ---------- */
function promptForTool(tool, inputs){
  const sys = 'You are a precise, helpful assistant writing fluent Persian unless asked otherwise. Keep answers clean, structured, and to-the-point.';
  const instMap = {
    'prompt_pro': `Ø¨Ø§ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø§Ù„Ú¯ÙˆÛŒ Ø²ÛŒØ± ÛŒÚ© Ù¾Ø±Ø§Ù…Ù¾Øª Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ø¨Ø³Ø§Ø²:\nRole: ${inputs.role||'Ù…ØªØ®ØµØµ'}\nGoal: ${inputs.goal||'Ø¨Ù‡ØªØ±ÛŒÙ† Ù†ØªÛŒØ¬Ù‡'}\nTone: ${inputs.tone||'Ø®Ù†Ø«ÛŒ'}\nConstraints: ${inputs.constraints||'Ø­Ø¬Ù… Ù…Ù†Ø§Ø³Ø¨'}\nØ§Ø² Ù…ØªÙ† Ú©Ø§Ø±Ø¨Ø± Ø¨Ù‡â€ŒØ¹Ù†ÙˆØ§Ù† Ø²Ù…ÛŒÙ†Ù‡ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù† Ùˆ Ù¾Ø±Ø§Ù…Ù¾Øª Ù†Ù‡Ø§ÛŒÛŒ Ø±Ø§ Ø¯Ø± ÛŒÚ© Ø¨Ù„ÙˆÚ© ÙˆØ§Ø­Ø¯ Ø¨Ø§Ø²Ú¯Ø±Ø¯Ø§Ù†.`,
    'summarize': `Ù…ØªÙ† Ø±Ø§ Ø¨Ø§ Ø´Ø¯Øª "${inputs.ratio||'Ù…ØªÙˆØ³Ø·'}" Ø®Ù„Ø§ØµÙ‡ Ú©Ù† Ùˆ Ø¨Ù‡ ØµÙˆØ±Øª ${inputs.bullets==='Ø¨ÙˆÙ„Øªâ€ŒÙ¾ÙˆÛŒÙ†Øª'?'Ø¨ÙˆÙ„Øªâ€ŒÙ¾ÙˆÛŒÙ†Øª':'Ù¾Ø§Ø±Ø§Ú¯Ø±Ø§Ù'} Ø§Ø±Ø§Ø¦Ù‡ Ø¨Ø¯Ù‡.`,
    'paraphrase': `Ù…ØªÙ† Ø±Ø§ Ø¨Ø§ Ø®Ù„Ø§Ù‚ÛŒØª ${inputs.creativity||'Ù…ØªÙˆØ³Ø·'}ØŒ Ø¨Ø§ Ø­ÙØ¸ Ù…Ø¹Ù†Ø§ Ø¨Ø§Ø²Ù†ÙˆÛŒØ³ÛŒ Ú©Ù†.`,
    'tone': `Ù…ØªÙ† Ø±Ø§ Ø¨Ù‡ Ù„Ø­Ù† "${inputs.tone||'Ø±Ø³Ù…ÛŒ'}" ØªØ¨Ø¯ÛŒÙ„ Ú©Ù†.`,
    'keywords': `Ø¨Ù‡ØªØ±ÛŒÙ† ${(inputs.count||10)} Ú©Ù„Ù…Ù‡/Ø¹Ø¨Ø§Ø±Øª Ú©Ù„ÛŒØ¯ÛŒ Ù…ØªÙ† Ø±Ø§ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ùˆ Ø¨Ù‡â€ŒØªØ±ØªÛŒØ¨ Ø§Ù‡Ù…ÛŒØª ÙÙ‡Ø±Ø³Øª Ú©Ù†.`,
    'sentiment': `ØªØ­Ù„ÛŒÙ„ Ø§Ø­Ø³Ø§Ø³Ø§Øª Ø§Ù†Ø¬Ø§Ù… Ø¨Ø¯Ù‡ (Ù…Ø«Ø¨Øª/Ù…Ù†ÙÛŒ/Ø®Ù†Ø«ÛŒ) Ùˆ ÛŒÚ© Ù†Ù…Ø±Ù‡ -1 ØªØ§ 1 Ø¨Ø¯Ù‡ Ùˆ Ø´ÙˆØ§Ù‡Ø¯ Ø±Ø§ Ø¨Ú¯Ùˆ.`,
    'title': `Ûµ Ø¹Ù†ÙˆØ§Ù† Ú©ÙˆØªØ§Ù‡ Ùˆ Ú¯ÛŒØ±Ø§ÛŒ Ø³Ø¨Ú© "${inputs.style||'Ù…Ø³ØªÙ‚ÛŒÙ…'}" Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø¨Ø¯Ù‡.`,
    'outline': `Outline Ø¨Ø§ Ø¹Ù…Ù‚ "${inputs.depth||'Ù…ØªÙˆØ³Ø·'}" ØªÙˆÙ„ÛŒØ¯ Ú©Ù† (H2/H3).`,
    'brainstorm': `Û±Û° Ø§ÛŒØ¯Ù‡ "${inputs.angle||'Ù†ÙˆØ¢ÙˆØ±Ø§Ù†Ù‡'}" Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø¨Ø¯Ù‡ØŒ Ù…Ø´Ø®Øµ Ùˆ Ù‚Ø§Ø¨Ù„â€ŒØ§Ø¬Ø±Ø§.`,
    'qa': `ÙÙ‚Ø· Ù¾Ø§Ø³Ø® Ø¯Ù‚ÛŒÙ‚ Ø¨Ù‡ Ø§ÛŒÙ† Ø³Ø¤Ø§Ù„ Ø±Ø§ Ø§Ø² Ù…ØªÙ† Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ú©Ù†: ${inputs.question||''}`,
    'translate': `${(inputs.dir||'FAâ†’EN')==='FAâ†’EN'?'Ù…ØªÙ† Ø±Ø§ Ø±ÙˆØ§Ù† Ø¨Ù‡ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ':'Ù…ØªÙ† Ø±Ø§ Ø±ÙˆØ§Ù† Ø¨Ù‡ ÙØ§Ø±Ø³ÛŒ'} ØªØ±Ø¬Ù…Ù‡ Ú©Ù†.`,
    'email': `Ø§ÛŒÙ…ÛŒÙ„ Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ Ø¨Ø§ Ù‡Ø¯Ù "${inputs.purpose||'Ø¯Ø±Ø®ÙˆØ§Ø³Øª'}" Ø¨Ù†ÙˆÛŒØ³. Ø³Ù„Ø§Ù… Ùˆ Ù¾Ø§ÛŒØ§Ù† Ù…Ø­ØªØ±Ù…Ø§Ù†Ù‡ Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯.`,
    'img_prompt': `ÛŒÚ© Ù¾Ø±Ø§Ù…Ù¾Øª ØªØµÙˆÛŒØ±ÛŒ ${inputs.style||'ÙˆØ§Ù‚Ø¹â€ŒÚ¯Ø±Ø§ÛŒØ§Ù†Ù‡'} Ø¨Ø³Ø§Ø² Ø¨Ø§ ØªÙˆØ¶ÛŒØ­ Ù…ÙˆØ¶ÙˆØ¹ØŒ Ø³Ø¨Ú©ØŒ Ø¬Ø²Ø¦ÛŒØ§Øª Ùˆ Ú©ÛŒÙÛŒØª.`,
    'tweet': `Û³ Ù†Ø³Ø®Ù‡ Ù¾Ø³Øª Ú©ÙˆØªØ§Ù‡ Ú©Ù…ØªØ± Ø§Ø² Û²Û¸Û° Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§ Ø­Ø³ "${inputs.vibe||'Ø§Ø·Ù„Ø§Ø¹ÛŒ'}" Ø§Ø±Ø§Ø¦Ù‡ Ø¨Ø¯Ù‡.`,
    'product': `ØªÙˆØ¶ÛŒØ­ Ù…Ø­ØµÙˆÙ„ ÙØ±ÙˆØ´â€ŒÙ…Ø­ÙˆØ± Ø¨Ø±Ø§ÛŒ Ù…Ø®Ø§Ø·Ø¨ "${inputs.aud||'Ø¹Ù…ÙˆÙ…ÛŒ'}" ØªÙˆÙ„ÛŒØ¯ Ú©Ù†: Ù…Ø²Ø§ÛŒØ§ Ùˆ ÙˆÛŒÚ˜Ú¯ÛŒâ€ŒÙ‡Ø§.`,
    'bullets': `Ù†Ú©Ø§Øª Ú©Ù„ÛŒØ¯ÛŒ Ù…ØªÙ† Ø±Ø§ Ø¯Ø± Ûµ ØªØ§ Û¸ Ø¨ÙˆÙ„Øªâ€ŒÙ¾ÙˆÛŒÙ†Øª Ø®Ù„Ø§ØµÙ‡ Ú©Ù†.`,
    'checklist': `Ù…ØªÙ† Ø±Ø§ Ø¨Ù‡ Ú†Ú©â€ŒÙ„ÛŒØ³ØªÛŒ Ø§Ø² Ú©Ø§Ø±Ù‡Ø§ÛŒ Ù‚Ø§Ø¨Ù„ Ø§Ù†Ø¬Ø§Ù… ØªØ¨Ø¯ÛŒÙ„ Ú©Ù† (Ø¬Ù…Ù„Ø§Øª Ú©ÙˆØªØ§Ù‡).`,
    'naming': `Û±Û° Ù†Ø§Ù… Ø¨Ø±Ù†Ø¯/Ù…Ø­ØµÙˆÙ„ Ø¨Ø§ Ø·Ø¹Ù… "${inputs.flavor||'ÙÙ†Ø§ÙˆØ±Ø§Ù†Ù‡'}" Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ Ø¨Ø¯Ù‡ Ùˆ Ù…Ø¹ÛŒØ§Ø± Ø§Ù†ØªØ®Ø§Ø¨ Ø±Ø§ Ø¨Ú¯Ùˆ.`,
    'ner': `Ù…ÙˆØ¬ÙˆØ¯ÛŒØªâ€ŒÙ‡Ø§ (Ù†Ø§Ù…ØŒ Ø³Ø§Ø²Ù…Ø§Ù†ØŒ ØªØ§Ø±ÛŒØ®) Ø±Ø§ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ùˆ ÙÙ‡Ø±Ø³Øª Ú©Ù†.`,
    'classify': `Ø¨Ø§ Ø¨Ø±Ú†Ø³Ø¨â€ŒÙ‡Ø§ÛŒ ${inputs.labels||'Ù…Ø«Ø¨Øª/Ù…Ù†ÙÛŒ/Ø®Ù†Ø«ÛŒ'} Ù…ØªÙ† Ø±Ø§ Ø·Ø¨Ù‚Ù‡â€ŒØ¨Ù†Ø¯ÛŒ Ú©Ù† Ùˆ Ø¯Ù„ÛŒÙ„ Ú©ÙˆØªØ§Ù‡ Ø¨ÛŒØ§ÙˆØ±.`
  };
  return { system: sys, instruction: instMap[tool.id] || 'Ù…ØªÙ† Ø±Ø§ Ø¨Ù‡ Ø¨Ù‡ØªØ±ÛŒÙ† Ø´Ú©Ù„ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ú©Ù†.' };
}

/* ---------- Local Runner ---------- */
function runLocal(tool, text){
  const g = state.inputs;
  switch(tool.id){
    case 'prompt_pro':
      return `SYSTEM: Ø´Ù…Ø§ ${g.role||'Ù…ØªØ®ØµØµ'} Ù‡Ø³ØªÛŒØ¯.\nGOAL: ${g.goal||'Ø­ØµÙˆÙ„ Ø¨Ù‡ØªØ±ÛŒÙ† Ø®Ø±ÙˆØ¬ÛŒ'}\nTONE: ${g.tone||'Ø®Ù†Ø«ÛŒ'}\nCONSTRAINTS: ${g.constraints||'Ù…Ø®ØªØµØ±ØŒ ÙˆØ§Ø¶Ø­'}\n\nPROMPT:\n${text}\n\nØ±Ø§Ù‡Ù†Ù…Ø§: Ù¾Ø§Ø³Ø® Ø±Ø§ Ø¯Ù‚ÛŒÙ‚ØŒ Ù…Ø±Ø­Ù„Ù‡â€ŒØ¨Ù‡â€ŒÙ…Ø±Ø­Ù„Ù‡ Ùˆ Ø¨Ø§ Ù…Ø«Ø§Ù„ Ø§Ø±Ø§Ø¦Ù‡ Ø¨Ø¯Ù‡.`;
    case 'summarize':
      return summarize(text, g.ratio||'Ù…ØªÙˆØ³Ø·', (g.bullets||'Ù¾Ø§Ø±Ø§Ú¯Ø±Ø§Ù')==='Ø¨ÙˆÙ„Øªâ€ŒÙ¾ÙˆÛŒÙ†Øª');
    case 'paraphrase':
      return paraphrase(text, g.creativity||'Ù…ØªÙˆØ³Ø·');
    case 'tone':
      return changeTone(text, g.tone||'Ø±Ø³Ù…ÛŒ');
    case 'keywords':
      return topKeywords(text, Number(g.count||10)).map((o,i)=>`${i+1}. ${o.w} (${o.c})`).join('\n');
    case 'sentiment':
      const s = sentiment(text);
      return `Ù†ØªÛŒØ¬Ù‡: ${s.label}\nÙ†Ù…Ø±Ù‡: ${s.score}\nÙ…Ø«Ø¨Øªâ€ŒÙ‡Ø§: ${s.pos} | Ù…Ù†ÙÛŒâ€ŒÙ‡Ø§: ${s.neg}`;
    case 'title':
      return title5(text, g.style||'Ù…Ø³ØªÙ‚ÛŒÙ…').join('\n');
    case 'outline':
      return outline(text, g.depth||'Ù…ØªÙˆØ³Ø·');
    case 'brainstorm':
      return ideas(text, g.angle||'Ù†ÙˆØ¢ÙˆØ±Ø§Ù†Ù‡');
    case 'qa':
      return qa(text, g.question||'');
    case 'translate':
      return translate(text, g.dir||'FAâ†’EN');
    case 'email':
      return email(text, g.purpose||'Ø¯Ø±Ø®ÙˆØ§Ø³Øª');
    case 'img_prompt':
      return imgPrompt(text, g.style||'ÙˆØ§Ù‚Ø¹â€ŒÚ¯Ø±Ø§ÛŒØ§Ù†Ù‡');
    case 'tweet':
      return tweet(text, g.vibe||'Ø§Ø·Ù„Ø§Ø¹ÛŒ');
    case 'product':
      return productDesc(text, g.aud||'Ø¹Ù…ÙˆÙ…ÛŒ');
    case 'bullets':
      return bullets(text);
    case 'checklist':
      return checklist(text);
    case 'naming':
      return naming(text, g.flavor||'ÙÙ†Ø§ÙˆØ±Ø§Ù†Ù‡');
    case 'ner':
      return ner(text);
    case 'classify':
      return classify(text, g.labels||'Ù…Ø«Ø¨Øª:Ø®ÙˆØ¨ØŒØ¹Ø§Ù„ÛŒ | Ù…Ù†ÙÛŒ:Ø¨Ø¯ØŒØ¶Ø¹ÛŒÙ | Ø®Ù†Ø«ÛŒ:Ù…Ø¹Ù…ÙˆÙ„ÛŒØŒØ¹Ø§Ø¯ÛŒ');
    default:
      return 'Ø§Ø¨Ø²Ø§Ø± Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª.';
  }
}

/* ---------- Events ---------- */
renderTaskList();
renderDynamicInputs();
document.addEventListener('DOMContentLoaded', ()=>{
  toolDescEl.textContent = TOOLS[0].desc;
});

searchEl.oninput = (e)=>renderTaskList(e.target.value.trim());

engineModeEl.onchange = ()=>{
  const show = engineModeEl.value!=='local';
  llmFieldsEl.style.display = show? 'block':'none';
  modeLabelEl.textContent = show? 'LLM' : 'Ù…Ø­Ù„ÛŒ';
};

runBtn.onclick = run;

copyBtn.onclick = async ()=>{
  await navigator.clipboard.writeText(outputEl.textContent||'');
  setStatus('Ú©Ù¾ÛŒ Ø´Ø¯!');
  setTimeout(()=>setStatus('Ø¢Ù…Ø§Ø¯Ù‡'), 1200);
};
downloadBtn.onclick = ()=>{
  const blob = new Blob([outputEl.textContent||''], {type:'text/plain;charset=utf-8'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = `ai-output-${state.tool}.txt`;
  a.click();
};

exportBtn.onclick = ()=>{
  const data = JSON.stringify(state, null, 2);
  const blob = new Blob([data], {type:'application/json;charset=utf-8'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'ai-studio-state.json'; a.click();
};
importBtn.onclick = async ()=>{
  const inp = document.createElement('input'); inp.type='file'; inp.accept='.json,application/json';
  inp.onchange = async ()=>{
    const file = inp.files[0]; const txt = await file.text();
    try{ const obj = JSON.parse(txt); state = {...state, ...obj}; renderTaskList(searchEl.value); renderDynamicInputs(); setStatus('ÙˆØ§Ø±Ø¯ Ø´Ø¯'); }catch{ setStatus('JSON Ù†Ø§Ù…Ø¹ØªØ¨Ø±'); }
  };
  inp.click();
};
clearBtn.onclick = ()=>{
  inputTextEl.value=''; outputEl.textContent=''; state.inputs={}; renderDynamicInputs(); setStatus('Ù¾Ø§Ú© Ø´Ø¯');
};
</script>
</body>
</html>
